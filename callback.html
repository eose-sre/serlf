<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://buy.stripe.com https://billing.stripe.com; frame-src https://buy.stripe.com">
<title>Signing in... | SERLF</title>
<link rel="stylesheet" href="styles.css">
<style>
body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#0a1628 0%,#1e3a5f 100%)}
.cb{text-align:center;max-width:400px;padding:2rem}
.cb .logo{font-size:2rem;font-weight:700;color:var(--cyan);margin-bottom:2rem}
.spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,.2);border-radius:50%;border-top-color:var(--cyan);animation:spin 1s linear infinite;margin:0 auto 1.5rem}
@keyframes spin{to{transform:rotate(360deg)}}
.error-message{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);border-radius:8px;padding:1rem;margin-top:1rem;color:#fecaca;display:none}
.retry-btn{background:var(--cyan);color:var(--bg);border:none;border-radius:6px;padding:.75rem 1.5rem;font-weight:500;cursor:pointer;margin-top:1rem}
</style>
</head>
<body>
<div class="cb">
<div class="logo">SERLF<span style="color:var(--maple)">üçÅ</span></div>
<div class="spinner"></div>
<div class="status-text" style="color:var(--fg2)">Signing you in...</div>
<div class="error-message" id="error-container">
<div id="error-text">Something went wrong.</div>
<button class="retry-btn" onclick="location.href='/login.html'">Try Again</button>
</div>
</div>

<script src="auth.js"></script>
<script>
(function(){
  function showError(msg) {
    document.querySelector('.spinner').style.display='none';
    document.querySelector('.status-text').style.display='none';
    const el = document.getElementById('error-container');
    el.style.display='block';
    document.getElementById('error-text').textContent=msg;
  }

  window.addEventListener('message', function(e) {
    if (e.origin !== window.location.origin) return;
    if (e.data.type === 'GOOGLE_SIGNIN_SUCCESS') {
      const userData = SERLF_AUTH.validateGoogleToken(e.data.credential);
      if (!userData) return showError('Invalid token');
      userData.token = e.data.credential;
      SERLF_AUTH.setSession(userData);
      setTimeout(() => { window.location.href = SERLF_AUTH.getRedirectUrl(); }, 500);
    }
  });

  // Timeout
  setTimeout(() => {
    if (!SERLF_AUTH.isAuthenticated()) showError('Sign-in timed out. Please try again.');
  }, 10000);
})();
</script>
</body>
</html>
