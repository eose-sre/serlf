<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sign In | SERLF</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<link rel="stylesheet" href="styles.css">
<style>
body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#0a1628 0%,#1e3a5f 100%)}
.login-container{background:rgba(255,255,255,.05);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:2.5rem;text-align:center;max-width:420px;width:90%;box-shadow:0 25px 50px rgba(0,0,0,.3)}
.login-container .logo{font-size:2.5rem;font-weight:700;color:var(--cyan);margin-bottom:.25rem}
.login-container .tagline{color:var(--fg2);margin-bottom:2rem;font-size:.95rem}
#g_id_signin{display:flex;justify-content:center;margin:1.5rem 0}
.price-callout{background:rgba(244,162,97,.1);border:1px solid rgba(244,162,97,.2);border-radius:12px;padding:1.25rem;margin-top:2rem}
.price-callout .amt{font-size:2rem;font-weight:900;color:var(--gold)}
.loading{display:none;color:var(--fg2);margin-top:1rem}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:var(--cyan);animation:spin 1s linear infinite;margin-right:.5rem}
@keyframes spin{to{transform:rotate(360deg)}}
.error-message{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);border-radius:8px;padding:1rem;margin-top:1rem;color:#fecaca;display:none}
.back-link{display:block;margin-top:1.5rem;color:var(--fg2);font-size:.85rem}
</style>
</head>
<body>
<div class="login-container">
<div class="logo">SERLF<span style="color:var(--maple)">üçÅ</span></div>
<div class="tagline">Become the enterprise.</div>

<div id="g_id_signin"></div>
<div class="loading" id="loading"><span class="spinner"></span>Signing you in...</div>
<div class="error-message" id="error-message"></div>

<div class="price-callout">
<div class="amt">$1<span style="font-size:.4em;color:var(--fg2)">/mo</span></div>
<p style="color:var(--fg2);font-size:.85rem;margin-top:.5rem">All 12 products. Everything included.<br>Sign in with Google to get started.</p>
</div>

<a href="/" class="back-link">‚Üê Back to serlf.ca</a>
</div>

<script src="auth.js"></script>
<script src="stripe-checkout.js"></script>
<script>
if (SERLF_AUTH.isAuthenticated()) {
  window.location.href = SERLF_AUTH.isSubscribed() ? '/app.html' : '/stripe-checkout.html';
}

window.onload = function() {
  google.accounts.id.initialize({
    client_id: '758788284456-vf6gmi5a8gkbr1oqu2ohol3p3i7m9s8e.apps.googleusercontent.com',
    callback: handleCredentialResponse,
    auto_select: false
  });
  google.accounts.id.renderButton(
    document.getElementById('g_id_signin'),
    { theme: 'filled_blue', size: 'large', type: 'standard', shape: 'rectangular', text: 'signin_with', width: '300' }
  );
};

function handleCredentialResponse(response) {
  document.getElementById('loading').style.display = 'block';
  document.getElementById('error-message').style.display = 'none';
  try {
    const userData = SERLF_AUTH.validateGoogleToken(response.credential);
    if (!userData) throw new Error('Invalid or expired token');
    if (!SERLF_AUTH.isAdmin(userData.email) && !userData.email_verified) throw new Error('Please use a verified Google account');
    userData.token = response.credential;
    SERLF_AUTH.setSession(userData);
    setTimeout(() => {
      window.location.href = SERLF_AUTH.isSubscribed() ? '/app.html' : '/stripe-checkout.html';
    }, 800);
  } catch (error) {
    document.getElementById('loading').style.display = 'none';
    const el = document.getElementById('error-message');
    el.style.display = 'block';
    el.textContent = error.message;
    setTimeout(() => el.style.display = 'none', 5000);
  }
}
</script>
</body>
</html>
